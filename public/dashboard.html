<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Sidebar Animation */
    .slide-in {
      transition: transform 0.3s ease-in-out;
      transform: translateX(100%); /* Sidebar hidden by default */
    }
    .slide-in.active {
      transform: translateX(0); /* Sidebar visible */
    }

    /* Submenu Animation */
    .submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    .submenu.open {
      max-height: 500px; /* Adjust based on content */
    }

        /* Modern blinking animation for active status */
        @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .blinking-circle {
      width: 12px;
      height: 12px;
      background-color: #10B981; /* Modern green color */
      border-radius: 50%;
      animation: blink 1.5s infinite;
      box-shadow: 0 0 8px rgba(16, 185, 129, 0.6); /* Glow effect */
    }

    .blinkingA-circle {
      width: 12px;
      height: 12px;
      background-color: #ba0808; /* Modern green color */
      border-radius: 50%;
      animation: blink 1.5s infinite;
      box-shadow: 0 0 8px rgba(16, 185, 129, 0.6); /* Glow effect */
    }

    /* Hover effect for event cards */
    .event-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .event-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }
  </style>
</head>
<body class="bg-gradient-to-r from-blue-500 to-indigo-600 min-h-screen relative">
  <!-- Burger Menu -->
  <div class="absolute top-4 left-4 z-50">
    <div id="burger-menu" class="cursor-pointer">
      <div class="w-8 h-1 bg-white mb-1 rounded"></div>
      <div class="w-8 h-1 bg-white mb-1 rounded"></div>
      <div class="w-8 h-1 bg-white rounded"></div>
    </div>
  </div>

  <!-- Logo and Active Events Container -->
  <div class="flex flex-col items-center justify-center pt-10">
    <!-- Logo -->
    <img src="/samilogod.png" alt="Logo" class="w-40 h-40 mb-8">


  <!-- Main Content -->
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-6"></h1>
    <div id="events-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 w-full max-w-4xl px-4">        <!-- Events will be dynamically inserted here -->
    </div>
  </div>

  <!-- Sidebar -->
  <div id="sidebar" class="w-64 bg-white shadow-lg h-full slide-in fixed right-0 top-0 z-40">
    <div class="p-6 flex flex-col justify-between h-full">
      <!-- Top Section -->
      <div>
        <!-- User Profile -->
        <div class="flex flex-col items-center">
          <img src="user.png" alt="User Image" class="w-24 h-24 rounded-full shadow-lg">
          <h2 class="mt-4 text-xl font-semibold text-gray-700">Admin</h2>
          <p class="text-gray-500">Welcome back!</p>
        </div>

        <!-- Navigation Links -->
        <ul class="mt-6 space-y-4">
          <!-- Admin Section -->
          <li>
            <button id="admin-toggle" class="flex items-center justify-between w-full text-left px-4 py-2 text-gray-700 font-semibold hover:bg-gray-100 rounded-md">
              <span class="flex items-center">
                <svg class="w-5 h-5 text-blue-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 2a6 6 0 100 12A6 6 0 0010 2zM2 10a8 8 0 1116 0A8 8 0 012 10z"></path>
                </svg>
                Admin
              </span>
              <svg id="admin-icon" class="w-5 h-5 text-gray-500 transform transition-transform" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 9.293a1 1 0 011.414 0L10 12.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            </button>
            <ul id="admin-submenu" class="submenu pl-8 space-y-2">
                <li>
                    <button id="add-event-button" class="flex items-center justify-between w-full text-left px-4 py-2 text-gray-700 font-semibold hover:bg-gray-100 rounded-md">
                      <span class="flex items-center">
                        <svg class="w-5 h-5 text-blue-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M10 2a6 6 0 100 12A6 6 0 0010 2zM2 10a8 8 0 1116 0A8 8 0 012 10z"></path>
                        </svg>
                        Add Events
                      </span>
                    </button>
                  </li>
                  <!-- Add Actors Link -->
                <li>
                    <a href="/add-actors-form" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md">
                    <svg class="w-5 h-5 text-purple-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path>
                    </svg>
                    Add Actors
                    </a>
                </li>
                <li>
                    <li>
                        <a href="#" id="view-archived-button" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md transition duration-200">
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4m16 0c0 4.418-3.582 8-8 8s-8-3.582-8-8m16 0a8 8 0 10-16 0m4 4v1a2 2 0 002 2h4a2 2 0 002-2v-1m-6-4v-1a2 2 0 114 0v1" />
                          </svg>
                          View Archived
                        </a>
                      </li>
                      
            </ul>
          </li>

          <!-- Cashier Section -->
          <li>
            <a href="/dashboard" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md">
              <svg class="w-5 h-5 text-green-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                <path d="M4 4h12v12H4V4zM2 2h16v16H2V2z"></path>
              </svg>
              Cashier
            </a>
          </li>

          <!-- Report Section -->
          <li>
            <a href="/views/reports.html" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md">
                <svg class="w-5 h-5 text-red-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 3h16a1 1 0 011 1v10a1 1 0 01-1 1H2a1 1 0 01-1-1V4a1 1 0 011-1zM3 5v8h14V5H3z"></path>
                </svg>
                Reports
            </a>
        </li>
        <li>
          <a href="/views/settings.html" class="flex items-center px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md transition duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3L6.5 4.964A5 5 0 004.036 8.5L3 12m6.75-9L12 3l3.75 1.5M9.75 3v1.5M12 3v1.5m0 16v-4.5m0-7V3m0 16l3.75-1.5m-7.5 0L9 17m6 0h4.5m0 0l-1.5-3.75M21 17h-4.5M21 17l-1.5 3.75M3 12h4.5m0 0L7 8.25m0 3.75H3m0 0l1.5 3.75m12-7.5h4.5M3 12l3.75 1.5" />
            </svg>
            Setting
          </a>
          
      </li>
        </ul>
      </div>

      <!-- Logout Button -->
      <div>
        <a href="/" id="logout-button" class="flex items-center px-4 py-2 text-white bg-red-500 hover:bg-red-600 rounded-md shadow-md">
          <svg class="w-5 h-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
            <path d="M3 10a1 1 0 011-1h8a1 1 0 110 2H4a1 1 0 01-1-1zm11-7a1 1 0 00-1 1v4H6V4a1 1 0 10-2 0v12a1 1 0 002 0v-4h7v4a1 1 0 102 0V4a1 1 0 00-1-1z"></path>
          </svg>
          Logout
        </a>
      </div>
    </div>
  </div>

  <script>
    // Submenu Toggle
    const adminToggle = document.getElementById("admin-toggle");
    const adminSubmenu = document.getElementById("admin-submenu");
    const adminIcon = document.getElementById("admin-icon");

    adminToggle.addEventListener("click", () => {
      adminSubmenu.classList.toggle("open");
      adminIcon.classList.toggle("rotate-180");
    });

    // Sidebar Toggle
    const sidebar = document.getElementById("sidebar");
    const burgerMenu = document.getElementById("burger-menu");

    burgerMenu.addEventListener("click", () => {
      sidebar.classList.toggle("active");
    });

    // Logout Button
    const logoutButton = document.getElementById("logout-button");
    logoutButton.addEventListener("click", (event) => {
      event.preventDefault();
      window.location.href = "/"; // Redirect to the main page
    });

    // Add Event Button
    const addEventButton = document.getElementById("add-event-button");
    addEventButton.addEventListener("click", () => {
    window.location.href = "/add-event-form"; // Redirect to the add event form
    });
  </script>
   <script>
    async function fetchActiveEvents() {
        try {
            const response = await fetch('/get-active-events');
            if (!response.ok) throw new Error('Failed to fetch events');

            const events = await response.json();
            const eventsContainer = document.getElementById('events-container');
            eventsContainer.innerHTML = ''; // Clear previous content

            events.forEach(event => {
                const eventCard = document.createElement('div');
                eventCard.classList.add('event-card', 'bg-white', 'rounded-lg', 'shadow-md', 'overflow-hidden', 'cursor-pointer', 'transition-transform', 'duration-300', 'hover:scale-105');
                eventCard.setAttribute('data-event-id', event.id);

                eventCard.innerHTML = `
                    <div class="relative">
                        <img src="/images/${event.event_image}" alt="${event.event_name}" class="w-full h-40 object-cover">
                        <div class="absolute top-2 right-2">
                            <div class="blinking-circle"></div>
                        </div>
                    </div>
                    <div class="p-4">
                        <h2 class="text-lg font-bold text-gray-800 mb-2">${event.event_name}</h2>
                        <p class="text-gray-600 mb-4">
                            <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>
                            ${event.event_location}, ${event.event_country}
                        </p>
                        <div class="flex justify-between items-center">
                        
                        <!-- Archive Button -->
                            <button class="archive-event-button bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300" data-event-id="${event.id}">
                            <i class="fas fa-archive mr-2"></i>Archive
                            </button>
                        </div>
                    </div>
                `;
                    
                // Make the event card clickable
                eventCard.addEventListener("click", () => {
                    window.location.href = `/views/pos.html?event_id=${event.id}`;
                });

                eventsContainer.appendChild(eventCard);
            });
            
            // Add event listeners for Edit buttons
            document.querySelectorAll('.edit-event-button').forEach(button => {
            button.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent the event card click from firing
                const eventId = button.getAttribute('data-event-id');
                window.location.href = `/edit-event-form?event_id=${eventId}`; // Redirect to edit form
            });
            });
            document.querySelectorAll('.archive-event-button').forEach(button => {
            button.addEventListener('click', async (e) => {
                e.stopPropagation(); // Prevent the event card click from firing
                const eventId = button.getAttribute('data-event-id');
                
                // Assuming userRole is stored in the frontend (e.g., fetched after login)
                const userRole = 'Admin'; // Replace this with dynamic logic if needed

                try {
                    const response = await fetch('/archive-event', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ eventId, userRole }),
                    });

                    const result = await response.json();

                    if (!response.ok) throw new Error(result.message);

                    alert(result.message);
                    // Refresh the events list after archiving
                    fetchActiveEvents();
                } catch (error) {
                    console.error('Error archiving event:', error);
                    alert(error.message || 'Failed to archive event. Please try again.');
                }
            });
        });


        } catch (error) {
            console.error('Error fetching events:', error);
            alert('Failed to load events. Please try again.');
        }
    }

    // Fetch events when the dashboard loads
    document.addEventListener('DOMContentLoaded', fetchActiveEvents);

    // View Archived Button
document.getElementById('view-archived-button').addEventListener('click', async () => {
  try {
    const response = await fetch('/get-archived-events');
    if (!response.ok) throw new Error('Failed to fetch archived events');

    const archivedEvents = await response.json();
    const eventsContainer = document.getElementById('events-container');
    eventsContainer.innerHTML = ''; // Clear previous content

    // Display archived events
    archivedEvents.forEach(event => {
      const eventCard = document.createElement('div');
      eventCard.classList.add('event-card', 'bg-white', 'rounded-lg', 'shadow-md', 'overflow-hidden', 'cursor-pointer', 'transition-transform', 'duration-300', 'hover:scale-105');
      eventCard.setAttribute('data-event-id', event.id);

      eventCard.innerHTML = `
        <div class="relative">
          <img src="/images/${event.event_image}" alt="${event.event_name}" class="w-full h-40 object-cover">
          <div class="absolute top-2 right-2">
            <div class="blinkingA-circle"></div>
          </div>
        </div>
        <div class="p-4">
          <h2 class="text-lg font-bold text-gray-800 mb-2">${event.event_name}</h2>
          <p class="text-gray-600 mb-4">
            <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>
            ${event.event_location}, ${event.event_country}
          </p>
          <div class="flex justify-between items-center">
            <!-- Edit Button -->
            <button class="edit-event-button bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-300" data-event-id="${event.id}">
              <i class="fas fa-edit mr-2"></i>Edit
            </button>
          </div>
        </div>
      `;

      // Add event listener for the Edit button
      eventCard.querySelector('.edit-event-button').addEventListener('click', (e) => {
        e.stopPropagation();
        window.location.href = `/views/editEventForm.html?event_id=${event.id}`; // Pass correct event_id in URL
      });
      eventsContainer.appendChild(eventCard);
    });
  } catch (error) {
    console.error('Error fetching archived events:', error);
    alert('Failed to load archived events. Please try again.');
  }
});

</script>
  
</body>
</html>
